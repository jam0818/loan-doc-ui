# E2Eテストシナリオチェックリスト（完全版）

このドキュメントはPlaywright Codegenを使用して手動でテストを作成する際のガイドラインです。
コンポーネント分析に基づき、全機能を網羅しています。

## 前提条件

```bash
# サーバー起動
bun run test:server  # ポート3001
bun run dev          # ポート3000

# Codegen起動
npx playwright codegen http://localhost:3000
```

---

## 1. 認証シナリオ (`auth.spec.ts`)

### 正常系
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| AUTH-01 | ログイン成功 | user1/password入力 → ログイン | メイン画面に遷移 |
| AUTH-02 | セッション維持 | ログイン → リロード | ログイン状態維持 |
| AUTH-03 | ログアウト成功 | ログアウトボタンクリック | ログイン画面に遷移 |

### 異常系・境界値
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| AUTH-04 | ログイン失敗 | invalid/wrong入力 | エラーメッセージ表示 |
| AUTH-05 | ボタン無効（ユーザー名空） | パスワードのみ入力 | ボタンdisabled |
| AUTH-06 | ボタン無効（パスワード空） | ユーザー名のみ入力 | ボタンdisabled |
| AUTH-07 | ボタン無効（両方空） | 何も入力しない | ボタンdisabled |

---

## 2. ドキュメント管理シナリオ (`documents.spec.ts`)

### 作成シナリオ
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| DOC-01 | 作成成功（タイトルのみ） | タイトル入力 → 作成 | ダイアログ閉じ、リストに表示 |
| DOC-02 | 作成成功（フィールド付き） | タイトル + フィールド追加 → 作成 | フィールドも保存 |
| DOC-03 | 作成キャンセル | ダイアログ開く → キャンセル | ダイアログ閉じ、作成されない |
| DOC-04 | 作成バリデーション（タイトル空） | タイトル空で作成 | ダイアログ閉じない |

### フィールド操作（作成ダイアログ内）
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| DOC-05 | フィールド追加 | 「フィールド追加」ボタンクリック | フィールド入力欄が追加 |
| DOC-06 | フィールド削除 | フィールドの削除ボタンクリック | フィールドが削除 |
| DOC-07 | 複数フィールド追加 | 3つのフィールドを追加して作成 | 全フィールド保存 |

### 編集シナリオ
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| DOC-08 | 編集成功（タイトル変更） | タイトル変更 → 保存 | 新タイトル表示 |
| DOC-09 | 編集成功（フィールド追加） | フィールド追加 → 保存 | フィールド増加 |
| DOC-10 | 編集成功（フィールド削除） | フィールド削除 → 保存 | フィールド減少 |
| DOC-11 | 編集キャンセル | 変更 → キャンセル | 変更反映されない |
| DOC-12 | 編集バリデーション（タイトル空） | タイトル空で保存 | ダイアログ閉じない |

### 削除シナリオ
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| DOC-13 | 削除成功 | 削除 → 確認ダイアログで実行 | ドキュメント消える |
| DOC-14 | 削除キャンセル | 削除 → キャンセル | ドキュメント残存 |

### ボタン状態
| ID | シナリオ | 状態 | 検証 |
|---|---|---|---|
| DOC-15 | 編集ボタン無効 | ドキュメント未選択 | disabled |
| DOC-16 | 削除ボタン無効 | ドキュメント未選択 | disabled |

### 選択・表示
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| DOC-17 | ドキュメント選択 | ドロップダウンから選択 | 詳細表示、プロンプト列有効化 |
| DOC-18 | 選択クリア | クリアボタン | 選択解除、編集/削除ボタン無効 |
| DOC-19 | 選択切替 | 別ドキュメント選択 | 詳細が切り替わる |

---

## 3. プロンプト管理シナリオ (`prompts.spec.ts`)

### 作成シナリオ
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| PROMPT-01 | 作成成功（全体タイプ） | 名前 + 全フィールド共通 → 作成 | ダイアログ閉じ、リストに表示 |
| PROMPT-02 | 作成成功（個別タイプ） | 名前 + 個別フィールド用 → 作成 | 同上 |
| PROMPT-03 | 作成キャンセル | ダイアログ開く → キャンセル | 作成されない |
| PROMPT-04 | 作成バリデーション（名前空） | 名前空で作成 | ダイアログ閉じない |
| PROMPT-05 | 作成ボタン無効 | ドキュメント未選択時 | ボタンdisabled |

### 編集シナリオ
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| PROMPT-06 | 編集成功（名前変更） | 名前変更 → 保存 | 新名前表示 |
| PROMPT-07 | 編集成功（タイプ変更警告） | タイプを変更 | 警告メッセージ表示 |
| PROMPT-08 | 編集キャンセル | 変更 → キャンセル | 変更反映されない |
| PROMPT-09 | 編集バリデーション（名前空） | 名前空で保存 | ダイアログ閉じない |
| PROMPT-10 | 編集ボタン無効 | プロンプト未選択時 | disabled |

### 削除シナリオ
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| PROMPT-11 | 削除成功 | 削除 → 確認ダイアログで実行 | プロンプト消える |
| PROMPT-12 | 削除キャンセル | 削除 → キャンセル | プロンプト残存 |
| PROMPT-13 | 削除ボタン無効 | プロンプト未選択時 | disabled |

### プロンプトテキスト編集
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| PROMPT-14 | 全体プロンプト入力 | テキストエリアに入力 | 入力値が保持 |
| PROMPT-15 | 個別プロンプト入力 | フィールドごとにテキスト入力 | 各フィールドに保持 |
| PROMPT-16 | プロンプト切替（選択） | ドロップダウンで別プロンプト選択 | 内容が切り替わる |

### モード切替
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| PROMPT-17 | 生成用モード表示 | プロンプト選択後、初期状態 | 「生成用プロンプト」アラート |
| PROMPT-18 | 修正用モード切替 | 「修正用」ボタンクリック | 「修正用プロンプト」アラート |
| PROMPT-19 | モード切替往復 | 生成用 ↔ 修正用 | アラート切替 |

### 個別フィールドプロンプト
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| PROMPT-20 | エキスパンションパネル展開 | フィールド名クリック | テキストエリア表示 |
| PROMPT-21 | 設定済チップ | フィールドにプロンプト入力 | 「設定済」チップ表示 |
| PROMPT-22 | 再生成ボタン（修正用モード） | 修正用モードでフィールド展開 | 「再生成」ボタン表示 |

---

## 4. 生成シナリオ (`generation.spec.ts`)

### ボタン状態
| ID | シナリオ | 状態 | 検証 |
|---|---|---|---|
| GEN-01 | 生成ボタン無効（ドキュメント未選択） | ログイン直後 | disabled |
| GEN-02 | 生成ボタン無効（プロンプト未選択） | ドキュメントのみ選択 | disabled |
| GEN-03 | 生成ボタン有効 | 両方選択 | enabled |
| GEN-04 | 生成ボタン無効（生成中） | 生成実行中 | disabled + ローディング |

### 表示モード
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| GEN-05 | 生成前タブ表示 | 初期状態 | 「生成前」タブ選択、readonly |
| GEN-06 | 生成後タブ切替 | 「生成後」タブクリック | 編集可能 |
| GEN-07 | タブ切替往復 | 生成前 ↔ 生成後 | 内容切替 |

### 生成実行
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| GEN-08 | 生成実行成功 | 一括生成ボタンクリック | 生成後タブに結果表示 |
| GEN-09 | 生成中インジケーター | 生成実行中 | プログレス + テキスト表示 |
| GEN-10 | 自動モード切替 | 生成完了 | 修正用モードに切替 |

### 生成結果編集
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| GEN-11 | 生成結果編集 | 生成後タブでテキスト編集 | 変更保持 |

---

## 5. 統合シナリオ (`integration.spec.ts`)

### End-to-Endフロー
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| E2E-01 | 完全ユーザーフロー | ログイン → Doc作成 → Prompt作成 → 生成 → ログアウト | 全ステップ成功 |
| E2E-02 | 複数リソース操作 | 複数Doc/Prompt作成 → 切替・編集・削除 | 全操作成功 |

### 状態管理
| ID | シナリオ | 操作 | 検証 |
|---|---|---|---|
| E2E-03 | セッション復帰 | 操作中 → リロード | 選択状態復元 |
| E2E-04 | ドキュメント切替連動 | Doc1選択 → Doc2選択 | プロンプト選択リセット |

---

## Codegenで記録する際のヒント

### ロケータの優先順位
1. `getByRole('button', { name: '...' })` - アクセシブルな名前
2. `getByLabel('...')` - フォーム入力
3. `getByText('...')` - 表示テキスト
4. `locator('.class').filter(...)` - 最後の手段

### 待機処理
- ダイアログ: `expect(getByText('タイトル')).toBeVisible()`
- API後: `expect(element).toBeVisible()` or `waitForResponse`
- アニメーション: `waitForTimeout(300)` (最小限に)

### テスト独立性
- `beforeEach`: ログインから開始
- 一意の名前: `${Date.now()}` 付与
- 後片付け: 必要に応じて削除

### エビデンス
```typescript
await page.screenshot({ path: 'evidence/XXX-before.png', fullPage: true })
// 操作
await page.screenshot({ path: 'evidence/XXX-after.png', fullPage: true })
```

---

## シナリオ数サマリ

| カテゴリ | 正常系 | 異常系 | 合計 |
|---------|--------|--------|------|
| 認証 | 3 | 4 | **7** |
| ドキュメント | 12 | 7 | **19** |
| プロンプト | 16 | 6 | **22** |
| 生成 | 8 | 3 | **11** |
| 統合 | 4 | 0 | **4** |
| **合計** | **43** | **20** | **63** |
